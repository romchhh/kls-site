# –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –ø–æ –¥–µ–ø–ª–æ—é–º–µ–Ω—Ç—É

## –ú—ñ–≥—Ä–∞—Ü—ñ—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ

### –í–∞–∂–ª–∏–≤–æ! –†—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ –∫–æ–º–∞–Ω–¥–∞–º–∏:

- **`npm run db:migrate`** (–∞–±–æ `prisma migrate dev`) - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–¢–Ü–õ–¨–ö–ò –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏**
  - –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó
  - –ú–æ–∂–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —ñ—Å–Ω—É—é—á—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó
  - **–ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä—ñ!**

- **`npm run db:migrate:deploy`** (–∞–±–æ `prisma migrate deploy`) - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω**
  - –ó–∞—Å—Ç–æ—Å–æ–≤—É—î –≤—Å—ñ –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó
  - –ù–µ —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó
  - –ë–µ–∑–ø–µ—á–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞

### –ö—Ä–æ–∫–∏ –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:

#### 1. –ü—ñ–¥–≥–æ—Ç—É–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—ó –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω—ñ–π –º–∞—à–∏–Ω—ñ (—Ä–æ–∑—Ä–æ–±–∫–∞)
npm run db:migrate
# –¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –Ω–æ–≤—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ –ø–∞–ø—Ü—ñ prisma/migrations/

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –º—ñ–≥—Ä–∞—Ü—ñ—ó —Å—Ç–≤–æ—Ä–µ–Ω—ñ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
ls -la prisma/migrations/
```

#### 2. –ó–∞–∫–æ–º—ñ—Ç—å—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ Git

```bash
git add prisma/migrations/
git commit -m "Add database migrations"
git push
```

#### 3. –ù–∞ —Å–µ—Ä–≤–µ—Ä—ñ (–ø—ñ—Å–ª—è –¥–µ–ø–ª–æ—é –∫–æ–¥—É)

```bash
# 1. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—é –ø—Ä–æ–µ–∫—Ç—É
cd /path/to/your/project

# 2. –û–Ω–æ–≤—ñ—Ç—å –∫–æ–¥ (—è–∫—â–æ —â–µ –Ω–µ –∑—Ä–æ–±–∏–ª–∏)
git pull

# 3. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
npm install

# 4. –ó–≥–µ–Ω–µ—Ä—É–π—Ç–µ Prisma Client
npm run db:generate

# 5. –ó–∞—Å—Ç–æ—Å—É–π—Ç–µ –º—ñ–≥—Ä–∞—Ü—ñ—ó –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
npm run db:migrate:deploy
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π —Å–ø–æ—Å—ñ–± (—è–∫—â–æ –Ω–µ–º–∞—î npm –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ):

```bash
# –ë–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ —á–µ—Ä–µ–∑ Prisma CLI
npx prisma migrate deploy
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É –º—ñ–≥—Ä–∞—Ü—ñ–π:

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —è–∫—ñ –º—ñ–≥—Ä–∞—Ü—ñ—ó –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ
npx prisma migrate status
```

### –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏:

1. **–ó–∞–≤–∂–¥–∏ —Ä–æ–±—ñ—Ç—å backup –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –ø–µ—Ä–µ–¥ –º—ñ–≥—Ä–∞—Ü—ñ—î—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω!**
   ```bash
   # –ü—Ä–∏–∫–ª–∞–¥ –¥–ª—è PostgreSQL
   pg_dump -h localhost -U username -d database_name > backup_$(date +%Y%m%d_%H%M%S).sql
   ```

2. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è:**
   - –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `DATABASE_URL` –≤ `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ –≤–∫–∞–∑—É—î –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É –±–∞–∑—É –¥–∞–Ω–∏—Ö
   - –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–∏—Ö –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω!

3. **–ü–æ—Ä—è–¥–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ:**
   ```
   1. git pull (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É)
   2. npm install (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π)
   3. npm run db:generate (–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è Prisma Client)
   4. npm run db:migrate:deploy (–∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π)
   5. npm run build (–∑–±—ñ—Ä–∫–∞ Next.js)
   6. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (pm2 restart –∞–±–æ systemctl restart)
   ```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):

–ú–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –¥–µ–ø–ª–æ—é:

```bash
#!/bin/bash
# deploy.sh

set -e  # –ó—É–ø–∏–Ω–∏—Ç–∏—Å—è –ø—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ

echo "üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É..."
git pull

echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π..."
npm install

echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è Prisma Client..."
npm run db:generate

echo "üóÑÔ∏è  –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –º—ñ–≥—Ä–∞—Ü—ñ–π..."
npm run db:migrate:deploy

echo "üèóÔ∏è  –ó–±—ñ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç—É..."
npm run build

echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"
echo "‚ö†Ô∏è  –ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä!"
```

–ó—Ä–æ–±—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º:
```bash
chmod +x deploy.sh
./deploy.sh
```

### Troubleshooting:

**–ü–æ–º–∏–ª–∫–∞: "Migration engine failed to connect to the database"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `DATABASE_URL` –≤ `.env`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ –∑ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ firewall –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

**–ü–æ–º–∏–ª–∫–∞: "Migration X is in a failed state"**
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –º—ñ–≥—Ä–∞—Ü—ñ—ó
- –ú–æ–∂–ª–∏–≤–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Å—Ç–∞–Ω –º—ñ–≥—Ä–∞—Ü—ñ—ó –≤ –ë–î
- –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó Prisma

**–ü–æ–º–∏–ª–∫–∞: "The migration X is already applied"**
- –¶–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –º—ñ–≥—Ä–∞—Ü—ñ—è –≤–∂–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞
- –ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –º—ñ–≥—Ä–∞—Ü—ñ—è–º–∏

